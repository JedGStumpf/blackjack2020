#:kivy 1.11.1
#:import Factory kivy.factory.Factory

<HomeScreen>:
    #hs: home_screen
    FloatLayout:
        canvas.before:
            Color:
                rgba: 0,0.5,0,0.5


    BoxLayout:
        orientation: 'vertical'
        padding: 10
        canvas.before:
            Rectangle:
                size: self.size
                pos: self.pos
                source: 'card.png'


        BoxLayout:
            orientation: 'horizontal'
            size_hint: 0.1, 0.06


            Button:
                id: rules
                text: 'Rules'
                size_hint: 0.7, 1
                font_size: self.height*0.4
                text_size: self.size
                bold: True
                color: 0,0,0,1
                halign: 'center'
                valign: 'middle'
                background_normal: ''
                background_color: 0,1,0,0.7
                on_press: root.rules_popup()


        BoxLayout:
            orientation: 'vertical'
            size_hint: 1,0.4
            padding: 3

            Label:
                color: 1,0,0,1
                font_size: self.height/3.5
                text_size: self.size
                halign: 'center'
                valign: 'center'
                bold: True
                text: '$$BlackJack$$'
        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1,1
            padding: 10

            Image:
                source: 'ace_spade.png'
                keep_ratio: True
                allow_stretch: False
                size_hint_x: 0.55
                size_hint_y: 0.55
                pos_hint: {'center_x':1, 'center_y':0.8}
                canvas.before:
                    PushMatrix
                    Rotate:
                        angle: 15
                        origin: self.center
                canvas.after:
                    PopMatrix


            Image:
                source: 'king_diamond.png'
                keep_ratio: True
                allow_stretch: False
                size_hint_x: 0.55
                size_hint_y: 0.55
                pos_hint: {'center_x':0, 'center_y':0.8}
                canvas.before:
                    PushMatrix
                    Rotate:
                        angle: -15
                        origin: self.center
                canvas.after:
                    PopMatrix


    BoxLayout:
        padding: 10
        size_hint: 1, 0.1

        Button:
            id: join_table
            text: "Let's Play"
            font_size: root.height/15
            text_size: self.size 
            bold: True
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ''
            background_color: 0,1,0,0.7
            on_press:
                root.manager.current = 'game'


<SpinnerOption>:
    size_hint_y: None
    text_size : self.width, None
    height: self.texture_size[1]
    color: 0,0,0,1
    padding: 5, 5
    background_normal: ""
    background_color: 0.75,0.75,0.75,1


<RulesPopup>:
    id: rules_pop
    size_hint: 0.33, 0.4
    title_color: 1,1,1,1
    background_normal:""
    background_color: 0,0.25,0.5,1

    BoxLayout:
        orientation: 'vertical'
        size: root.size
        text_size: self.size
        
        Spinner:
            id: black_jack_rules
            text: 'Game Rules'
            values: [file_txt.strip() for file_txt in open(r'rules.txt').readlines()]
            halign: "center"
            valign: "center"
            line_wrap: True
            font_size: self.height/7
            text_size : self.width, None
            #padding: 5, 5
            color: 0,0,0,1
            background_normal: ""
            background_color: 0,0.5,0.5,0.7


        Button:
            id: link_strategy
            text: 'Wikepedia Basic Strategy'
            text_size: self.size
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ""
            background_color: 0,1,0.5,1
            on_press: root.redirect_popup()          
            

        Button:
            id: back_home
            size_hint: 1, 0.3
            text: 'Back to Game'
            text_size: self.size
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ""
            background_color: 0,0.5,1,1
            on_press: root.dismiss()

<RedirectPopup>:
    id: redirect
    title_color: 1,1,1,1
    background_normal: ""
    background_color: 0,0.25,0.5,1


    BoxLayout:
        orientation: 'vertical'
        size: root.size
        title_color: 1,1,1,1

        Label:
            text: 'Pressing "OK" will leave the Game and open Wikepedia Website'
            text_size: self.size
            color: 1,1,1,1
            halign: 'center'
            valign: 'middle'

        Button:
            id: gotowiki
            size_hint: 1, 0.3
            text: 'OK'
            color: 0,0,0,1
            on_press: root.open_link(*args)
        Button:
            id: back_to_rules
            size_hint: 1, 0.3
            text: 'Back to rules'
            text_size: self.size
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            on_press: root.dismiss()


<BetDropDown>:
    bdd: betdropdown
    id: betdropdown
    maxbet: bet_all
    size_hint_y: None

    Button:
        id: bet50
        text: '50'
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet50.text)
            app.game_screen.allow_bet = False
    Button:
        id: bet100
        text: '100'
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet100.text)
            app.game_screen.allow_bet = False
    Button:
        id: bet250
        text: '250'
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet250.text)
            app.game_screen.allow_bet = False
    Button:
        id: bet500
        text: '500'
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet500.text)
            app.game_screen.allow_bet = False
    Button:
        id: bet1000
        text: '1000'
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet1000.text)
            app.game_screen.allow_bet = False

    Button:
        id: bet_half
        text: ''
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet_half.text)
            app.game_screen.allow_bet = False


    Button:
        id: bet_all
        text: ''
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release:
            if app.game_screen.allow_bet == True: root.select(bet_all.text)
            app.game_screen.allow_bet = False

    Button:
        id: reset
        text: 'Reset Bet'
        size_hint_y: None
        height: 30
        text_size: self.size
        font_size: self.height/2.5
        color: 0,0,0,1
        halign: 'center'
        valign: 'middle'
        on_release: 
            app.game_screen.allow_bet = True


<BetTooHigh_Pop>:
    size_hint: 0.1, 0.7
    title_color: 1,1,1,1
    bold: True
    padding: 3
    background_normal: ""
    background_color: 0,0,0,0.9
    title_size: 12
    bold: True
    padding: 5

    BoxLayout:
        orientation: 'vertical'
        padding: 10
        Button:
            text: 'Not Enough Chips'
            bold: True
            text_size: self.size
            font_size: self.height/8
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ""
            background_color: 0,0.8,0.8,0.8
            padding: 5,5
            on_press: root.dismiss()  



<GameScreen>:
    bet_amnt: bet
    chp_count: chip_count
    canvas.before:
        Rectangle:
            size: self.size
            source: 'carpet.png'


    FloatLayout:
        id: All_Boxes
        padding: 3
        canvas.before:
            Color:
                rgba: 0, .3, .15, 1
            Ellipse:
                size: self.size
                pos: self.pos        
        Button:
            id: 'exit'
            text: 'Exit Rules'
            size_hint: 0.1, 0.075
            pos_hint: {"x":0.88, "top":1}
            text_size: self.size
            font_size: self.height/4
            bold: True
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal:""
            background_color: 0.5,0,0,0.9
            on_press: root.manager.current = 'end'
        

        BoxLayout:
            id: dealer
            orientation: 'vertical'
            text_size:self.size
            size_hint: 0.49,0.45
            pos_hint:{'x':0.265,'y':0.55}
            padding: 5

            BoxLayout:
                id: dealer_box
                orientation: 'horizontal'
                pos_hint: {'x': 0, 'y': 1}
                size_hint: 1, 0.3
                

                Image:
                    id: dealer_pic
                    source: 'dealer.png'
                    text_size: self.size
                    pos: self.pos
                    keep_ratio: False
                    allow_stretch: True
                    pos_hint: {'x': 0, 'y': 0.35}


                Image:
                    id: deck
                    source: 'deck.png'
                    size: self.size
                    pos: self.pos
                    allow_stretch: True
                    keep_ratio: True
                    size_hint: 0.2,1
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 70
                            origin: self.center
                    canvas.after:
                        PopMatrix

            BoxLayout:
                orientation: 'horizontal'
                id: dealer_hand_box 
                size_hint: 1,1
                pos_hint: {'x': 0, 'y': 1}
                padding: 5

                BoxLayout:
                    orientation: 'vertical'
                    id: dealer_cards

            Label:
                id: dealer_value
                text: 'Dealer Hand'
                text_size: self.size
                font_size: self.height/1.6
                color: 0,0,0,1
                bold: True
                halign: 'center'
                valign: 'middle'
                size_hint: 1, 0.15
                pos_hint: {'x': 0, 'y': 1}
            
        
        BoxLayout:
            orientation: 'horizontal'
            id: cp1_hand_box
            size_hint: 0.25, 0.45
            pos_hint:{"left_x":0,"center_y":0.705}
            padding: 5

            BoxLayout:
                orientation: 'vertical'

                BoxLayout:
                    orientation: 'horizontal'
                    id: cp1_hand
                    size_hint: 1, 1
                    pos_hint: {'x': 0, 'y': 1}
                    padding: 3

                    BoxLayout:
                        orientation: 'vertical'
                        id: cp1_cards
                
                Label:
                    id: cp1_value
                    text: 'Dolly Hand'
                    text_size: self.size
                    font_size: self.height/2.5
                    color: 0,0,0,1
                    bold: True
                    halign: 'center'
                    valign: 'middle'
                    size_hint: 1, 0.15
                    pos_hint: {'x': 0, 'y': 1}


        BoxLayout:
            orientation: 'horizontal'
            id: cp2_hand_box
            size_hint: 0.25, 0.45
            pos_hint:{"left_x":0,"y":0.05}
            padding: 5

            BoxLayout:
                orientation: 'vertical'

                BoxLayout:
                    orientation: 'horizontal'
                    id: cp2_hand
                    size_hint: 1, 1
                    pos_hint: {'x': 0, 'y': 1}
                    padding: 3

                    BoxLayout:
                        orientation: 'vertical'
                        id: cp2_cards
                    
                Label:
                    id: cp2_value
                    text: 'Mama Hand'
                    text_size: self.size
                    font_size: self.height/2.5
                    color: 0,0,0,1
                    bold: True
                    halign: 'center'
                    valign: 'middle'
                    size_hint: 1, 0.15
                    pos_hint: {'x': 0, 'y': 1}


        BoxLayout:
            orientation: 'horizontal'
            id: cp3_hand_box
            size_hint: 0.25, 0.45
            pos_hint:{'x': 0.72, "y":0.05}
            padding: 5

            BoxLayout:
                orientation: 'vertical'

                BoxLayout:
                    orientation: 'horizontal'
                    id: cp3_hand
                    size_hint: 1, 1
                    pos_hint: {'x': 0, 'y': 1}
                    padding: 3

                    BoxLayout:
                        orientation: 'vertical'
                        id: cp3_cards

                Label:
                    id: cp3_value
                    text: 'K-K Hand'
                    text_size: self.size
                    font_size: self.height/2.5
                    color: 0,0,0,1
                    bold: True
                    halign: 'center'
                    valign: 'middle'
                    size_hint: 1, 0.15
                    pos_hint: {'x': 0, 'y': 1}


        BoxLayout:
            orientation: 'horizontal'
            id: cp4_hand_box
            size_hint: 0.25, 0.45
            pos_hint:{'x':0.72, 'center_y': 0.705}
            padding: 5

            BoxLayout:
                orientation: 'vertical'

                BoxLayout:
                    orientation: 'horizontal'
                    id: cp4_hand
                    size_hint: 1, 1
                    pos_hint: {'x': 0, 'y': 1}
                    padding: 3

                    
                    BoxLayout:
                        orientation: 'vertical'
                        id: cp4_cards

                Label:
                    id: cp4_value
                    text: 'Bubba Hand'
                    text_size: self.size
                    font_size: self.height/2.5
                    bold: True
                    color: 0,0,0,1
                    halign: 'center'
                    valign: 'middle'                
                    size_hint: 1, 0.15
                    pos_hint: {'x': 0, 'y': 1}


        BoxLayout:
            id: player_hand_box
            orientation: 'horizontal'
            size_hint: 0.52, 0.50
            pos_hint:{'x':0.25, 'y':0.05}

            BoxLayout:
                orientation: 'vertical'


                BoxLayout:
                    orientation: 'horizontal'
                    id: player_hand
                    size_hint: 1, 1
                    pos_hint:{'x':0, 'center_y':0.5}
                    padding: 5
                    

                    BoxLayout:
                        orientation: 'vertical'
                        id: player_cards

                Label:
                    id: player_value
                    text: 'Your Hand'
                    text_size:self.size
                    font_size: self.height/2.5
                    color: 0,0,0,1
                    bold: True
                    halign:'center'
                    valign:'middle'
                    size_hint: 1,0.15
            
        BoxLayout:
            orientation: 'horizontal'
            id: play_buttons
            size_hint: 1, 0.065
            padding: 3

            Button:
                id: bet
                text: 'Bet'
                text_size:self.size
                font_size: self.height/2.5
                color: 0,0,0,1
                halign:'center'
                valign:'middle'
                size_hint: 0.8, 1
                on_release: 
                    if root.dealt_table == False: root.bet_drop.open(self), root.max_bet(), root.half_bet()

                    
            Button:
                id: new_deal
                text: 'Deal'
                text_size: self.size
                font_size: self.height/2.5
                color: 0,0,0,1
                halign: 'center'
                valign: 'middle'
                size_hint: 0.6,1
                on_release: 
                    if root.update_bet == True and app.game_screen.allow_bet == False: root.chips_minus_bet()

                    if root.dealt_table == False and app.game_screen.allow_bet == False: root.deal_table(self)


            Button:
                id: stay
                text: 'Stand'
                text_size: self.size
                font_size: self.height/2.5
                color: 0,0,0,1
                halign: 'center'
                valign: 'middle'
                on_release:
                    if root.banner == 'Play Your Hand': root.rem_display()

                    if root.hit_again == True: root.stay()



            Label:
                id: chip_count
                bold: True
                text: '10000'
                color: 0,0,0,1
                text_size: self.size
                font_size: self.height/2.5
                #font_size: '12sp'
                halign:'center'
                valign:'middle'
                size_hint: 1, 1
                canvas.before:
                    Ellipse:
                        source: 'chip.png'
                        pos: self.pos
                        size: self.size



            Button:
                id: double_down
                text: 'Double'
                text_size: self.size
                font_size: self.height/2.9
                color: 0,0,0,1
                halign: 'center'
                valign: 'middle'
                size_hint: 0.6,1
                on_release:
                    if root.banner == 'Play Your Hand': root.rem_display()

                    if root.hit_again  == True and root.special() == True and len(root.player_hands[root.who_deal].children) == 2: root.double_down(root.who_deal)

                    
            Button:
                id: split
                text: 'Split'
                text_size: self.size
                font_size: self.height/2.5
                color: 0,0,0,1
                halign: 'center'
                valign: 'middle'
                size_hint: 0.6,1
                on_release:
                    if root.banner == 'Play Your Hand': root.rem_display()

                    if root.allow_split(root.who_deal) == True and root.special() == True and root.hit_again == True: root.split(root.who_deal)

                    

            Button:
                id: hit
                text: 'Hit'
                text_size: self.size
                font_size: self.height/2.5
                color: 0,0,0,1
                halign: 'center'
                valign: 'middle'
                on_release:
                    if root.banner == 'Play Your Hand': root.rem_display()

                    if root.hit_again == True and root.dealt_table == True: root.deal_player(root.player_hands[root.who_deal])



<EndScreen>:
    canvas.before:
        Rectangle:
            size: self.size
            source: 'endpage.png'
            pos: self.pos
    
    BoxLayout:
        orientation: 'vertical'
        size_hint: 1, 0.2
        pos_hint: {'x':0, 'y':0.8}
        padding: 7

        Label:
            padding: 3,3
            size_hint: 1, 1
            text: 'Thanks for playing'
            font_size: self.height/2.5
            text_size: self.size
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            bold: True
               
    
    BoxLayout:
        orientation: 'vertical'
        size_hint: 0.5, 0.5
        pos_hint: {'x':0.25, 'y':0.1}
        padding: 7
            
        Button:
            text: 'Keep Playing'
            text_size: self.size
            font_size: self.height/5
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            bold: True
            background_normal: ""
            background_color: 0,0.5,0.5,0.7
            padding: 3,3
            on_press:
                root.manager.current = 'game'

        
        Label:
            size_hint: 1, 0.05
        
        Button:
            text: 'Leave Table?'
            bold: True
            text_size: self.size
            font_size: self.height/5
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ""
            background_color: 0.5,0,0,0.8
            padding: 3,3
            on_press: 
                root.exit_popup()
        Button:
            id: rules
            text: 'Rules'
            font_size: self.height*0.4
            text_size: self.size
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ''
            background_color: 0,1,0,0.7
            padding: 5,5
            on_press: app.homescreen.rules_popup() 

<ExitPopup>:
    size_hint: 0.1, 0.7
    title_color: 1,1,1,1
    bold: True
    padding: 3
    background_normal: ""
    background_color: 0,0,0,0.9
    title_size: 14
    bold: True
    padding: 5

    BoxLayout:
        orientation: 'vertical'
        padding: 10
        Button:
            text: 'Oops, keep playing'
            bold: True
            text_size: self.size
            font_size: self.height/6
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ""
            background_color: 0,0.8,0.8,0.8
            padding: 5,5
            on_press: root.dismiss()

        Label:
            size_hint: 1, 0.05

        Button:
            id: leave_table
            bold: True
            text: 'Leave Table'
            text_size: self.size
            font_size: self.height/6
            color: 0,0,0,1
            halign: 'center'
            valign: 'middle'
            background_normal: ""
            background_color: 0.6,0,0,0.5
            padding: 5,5
            on_press: exit()
        
           